"use strict";const Y=require("@codemirror/state"),t=require("@lezer/highlight"),p=require("markedit-api"),_=require("@codemirror/view"),y=require("@codemirror/language"),x=(a,n={})=>a??n,Z=x(p.MarkEdit.userSettings),N=j("extension.markeditTheming"),tt=C(!1)?x(N.lightTheme):void 0,et=C(!0)?x(N.darkTheme):void 0;function j(a){return a===void 0?{}:x(Z[a])}function G(a){return a.enabledMode??"both"}function C(a,n=G(N)){return["both",a?"dark":"light"].includes(n)}function ot(a,n,e){const c=rt({lhs:e,rhs:a?et:tt});return{extensions:[...a?P(c,{dark:!0}):P(c),n].filter(r=>r!==void 0),colors:c}}function P(a,n){const e={},c=[],o=a.editor,r=a.highlight;o?.textColor&&(e["&"]??={},e["&"].color=o?.textColor,e[".cm-activeLineGutter"]={backgroundColor:o?.textColor}),o?.backgroundColor&&(e["&"]??={},e["&"].backgroundColor=o?.backgroundColor),o?.activeLineBackground&&(e[".cm-activeLine"]={backgroundColor:o?.activeLineBackground}),o?.caretColor&&(e[".cm-content"]={caretColor:o?.caretColor},e[".cm-cursor, .cm-dropCursor"]={borderLeftColor:o?.caretColor}),o?.selectionBackground&&(e["&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection"]={backgroundColor:o?.selectionBackground}),o?.matchingBracketBackground&&(e["&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket"]={backgroundColor:o?.matchingBracketBackground}),o?.gutterText&&(e[".cm-gutters"]??={},e[".cm-gutters"].color=o?.gutterText),o?.gutterBackground&&(e[".cm-gutters"]??={},e[".cm-gutters"].backgroundColor=o?.gutterBackground,e[".cm-gutters"].border="none"),o?.foldPlaceholderText&&(e[".cm-foldPlaceholder"]??={},e[".cm-foldPlaceholder"].color=o?.foldPlaceholderText),o?.foldPlaceholderBackground&&(e[".cm-foldPlaceholder"]??={},e[".cm-foldPlaceholder"].backgroundColor=o?.foldPlaceholderBackground,e[".cm-foldPlaceholder"].border="none"),o?.searchMatchBackground&&(e[".cm-searchMatch"]={backgroundColor:o?.searchMatchBackground}),o?.selectionMatchBackground&&(e[".cm-selectionMatch"]={backgroundColor:o?.selectionMatchBackground}),r?.heading&&c.push({tag:t.tags.heading,color:r?.heading}),r?.bold&&c.push({tag:t.tags.strong,color:r?.bold}),r?.italic&&c.push({tag:t.tags.emphasis,color:r?.italic}),r?.strikethrough&&c.push({tag:t.tags.strikethrough,color:r?.strikethrough}),r?.quote&&c.push({tag:t.tags.quote,color:r?.quote}),r?.link&&c.push({tag:[t.tags.url,t.tags.link],color:r?.link}),r?.divider&&c.push({tag:t.tags.contentSeparator,color:r?.divider}),r?.comment&&c.push({tag:t.tags.comment,color:r?.comment}),r?.meta&&c.push({tag:t.tags.meta,color:r?.meta}),r?.keyword&&c.push({tag:t.tags.keyword,color:r?.keyword}),r?.atom&&c.push({tag:[t.tags.atom,t.tags.bool],color:r?.atom}),r?.literal&&c.push({tag:[t.tags.literal,t.tags.inserted],color:r?.literal}),r?.string&&c.push({tag:[t.tags.string,t.tags.deleted],color:r?.string}),r?.special&&c.push({tag:[t.tags.regexp,t.tags.escape,t.tags.special(t.tags.string)],color:r?.special}),r?.variable&&c.push({tag:t.tags.definition(t.tags.variableName),color:r?.variable}),r?.local&&c.push({tag:t.tags.local(t.tags.variableName),color:r?.local}),r?.type&&c.push({tag:[t.tags.typeName,t.tags.namespace],color:r?.type}),r?.class&&c.push({tag:t.tags.className,color:r?.class}),r?.macro&&c.push({tag:[t.tags.special(t.tags.variableName),t.tags.macroName],color:r?.macro}),r?.property&&c.push({tag:t.tags.definition(t.tags.propertyName),color:r?.property}),r?.label&&c.push({tag:t.tags.labelName,color:r?.label}),r?.operator&&c.push({tag:[t.tags.operator,t.tags.operatorKeyword],color:r?.operator}),r?.constant&&c.push({tag:[t.tags.color,t.tags.constant(t.tags.name),t.tags.standard(t.tags.name)],color:r?.constant}),r?.instruction&&c.push({tag:[t.tags.separator,t.tags.processingInstruction,t.tags.definition(t.tags.name)],color:r?.instruction}),r?.invalid&&c.push({tag:t.tags.invalid,color:r?.invalid});const l=[];return Object.keys(e).length>0&&l.push(_.EditorView.theme(e,n)),c.length>0&&l.push(y.syntaxHighlighting(y.HighlightStyle.define(c))),l}function rt(a){return{editor:{...a.lhs?.editor,...a.rhs?.editor},highlight:{...a.lhs?.highlight,...a.rhs?.highlight},allowsFallback:a.rhs?.allowsFallback??a.lhs?.allowsFallback}}const i={selectionBackground:".cm-selectionBackground",lineGutter:".cm-lineNumbers > .cm-activeLineGutter",foldGutter:".cm-foldGutter, .cm-foldPlaceholder",visibleSpace:".cm-visibleSpace, .cm-visibleSpace::before, .cm-visibleLineBreak, .cm-visibleLineBreak::before",matchingBracket:".cm-matchingBracket",activeIndicator:".cm-md-activeIndicator",accentColor:".cm-md-header:not(.tok-meta):not(.cm-md-quote), .cm-md-codeInfo",syntaxMarker:".cm-md-header.tok-meta:not(.cm-md-quote), .cm-md-codeMark, .cm-md-linkMark, .cm-md-listMark, .cm-md-quoteMark, .cm-md-bold.tok-meta, .cm-md-italic.tok-meta, .cm-md-strikethrough.tok-meta",boldText:".cm-md-bold:not(.tok-meta)",italicText:".cm-md-italic:not(.tok-meta)",quoteText:".cm-md-quote:not(.cm-md-quoteMark)",dividerColor:".cm-md-horizontalRule"},at=`
.cm-activeLineGutter { background: inherit !important }
.cm-searchMatch.cm-searchMatch-selected { outline: inherit !important }
${i.lineGutter} {}
${i.foldGutter} {}
${i.visibleSpace} {}
${i.matchingBracket} {}
${i.activeIndicator} {}
${i.accentColor} {}
${i.syntaxMarker} {}
${i.boldText} {}
${i.italicText} {}
${i.quoteText} {}
${i.dividerColor} {}
`,I=window,ct=I.__extractStyleRules__??(a=>a.value?.rules),nt=I.__extractHighlightSpecs__??(a=>a.value?.specs);function it(a){const n=document.createElement("style");return n.textContent=a,document.head.appendChild(n),n}function st(a){if(a.length===0)return[{},[]];const n=q(a);return[Object.fromEntries(n.flatMap(c=>{const o=ct(c)?.join(`
`)??"";return Object.entries(gt(o))})),n.flatMap(c=>nt(c)??[])]}function k(a,n,e){return a.find(c=>!!(c.tag.toString().includes(n.toString())&&c.color!==void 0))?.color??e}function w(a,n,e){for(const[c,o]of Object.entries(a))if(c.includes(n)&&(e===void 0||!c.includes(e))){const r=o.background??o.backgroundColor;if(r!==void 0)return r}}function lt(a){const n=a.match(/rgba?\((\d+), (\d+), (\d+)(?:, ([\d.]+))?\)/);if(n===null)return;const[e,c,o]=n.slice(1,4).map(Number);return`rgba(${e}, ${c}, ${o}, 0.6)`}function R(a){const n=o=>o!==null&&typeof o=="object";if(!n(a))return!0;const e=Object.entries(a),c=o=>o!=null;for(const[,o]of e)if(n(o)){if(!R(o))return!1}else if(c(o))return!1;return!0}function q(a){return Array.isArray(a)?a.flatMap(q):"extension"in a?q(a.extension):[a]}function gt(a){const n={},e=new CSSStyleSheet;e.replaceSync(a);for(const c of e.cssRules){const{style:o,selectorText:r}=c,{background:l,backgroundColor:u}=o;n[r]={},l.length>0&&(n[r].background=l),u.length>0&&(n[r].backgroundColor=u)}return n}function dt(a){const n=a.options?.settingsKey,e=G(j(n));a.light!==void 0&&C(!1,e)&&(g().customThemes.light=a.light),a.dark!==void 0&&C(!0,e)&&(g().customThemes.dark=a.dark),typeof p.MarkEdit.editorView=="object"&&L(p.MarkEdit.editorView)}const v=window,g=()=>v.__markeditTheming__,H=matchMedia("(prefers-color-scheme: dark)");typeof g()!="object"&&ut();function ut(){v.__markeditTheming__={styleSheet:it(at),configurator:new Y.Compartment,customThemes:{},lightOriginalRules:{},darkOriginalRules:{}},p.MarkEdit.addExtension(g().configurator.of([])),p.MarkEdit.onEditorReady(n=>L(n));const a=()=>setTimeout(()=>L(p.MarkEdit.editorView),15);H.addEventListener("change",a),g().mainThemeName=v.config.theme,Object.defineProperty(v.config,"theme",{get(){return g().mainThemeName},set(n){g().mainThemeName=n,a()}})}function L(a){const n=H.matches,e=n?g().customThemes.dark:g().customThemes.light,{extensions:c,colors:o}=ot(n,e?.extension,e?.colors);a.dispatch({effects:g().configurator.reconfigure(c)});const[r,l]=st(c),u=c.length===0&&R(o),h=o.allowsFallback??e?.extension!==void 0;g().styleSheet.disabled=u,mt(a,n,u,r,l,o,h)}function mt(a,n,e,c,o,r,l){const u=w(c,".cm-activeLine",".cm-activeLineGutter"),h=w(c,i.selectionBackground),B=w(c,i.matchingBracket),T=getComputedStyle(a.contentDOM).color,$=r.editor?.visibleSpaceColor??lt(T),f=l?T:void 0,E=k(o,t.tags.heading,f),D=k(o,t.tags.processingInstruction,f),V=k(o,t.tags.strong,f),K=k(o,t.tags.emphasis,f),z=k(o,t.tags.quote,f),Q=k(o,t.tags.contentSeparator,f),U=[[i.activeIndicator,u,"background"],[i.matchingBracket,B,"background"],[i.lineGutter,T,"color"],[i.foldGutter,$,"color"],[i.visibleSpace,$,"color"],[i.accentColor,E,"color"],[i.syntaxMarker,D,"color"],[i.boldText,V,"color"],[i.italicText,K,"color"],[i.quoteText,z,"color"],[i.dividerColor,Q,"color"]],W=Array.from(document.querySelectorAll("style")),b=n?g().darkOriginalRules:g().lightOriginalRules;for(const J of W){const S=J.sheet?.cssRules;if(S!==void 0)for(let M=0;M<S.length;++M){const d=S[M],m=d.selectorText??"";m.includes(".cm-focused")&&m.includes(i.selectionBackground)&&(b.selectionBackground??=d.cssText,e?d.cssText=b.selectionBackground:h!==void 0&&d.style.setProperty("background",h,"important")),E!==void 0&&(m===".cm-md-header"||m===".cm-md-header:not(.cm-md-quote)")&&(b.markdownHeader??=d.cssText,e?d.cssText=b.markdownHeader:d.style.removeProperty("color"));for(const[X,F,O]of U)m===X&&(F===void 0?d.style.removeProperty(O):(d.style.setProperty(O,F,"important"),(m===i.matchingBracket||m===i.activeIndicator)&&d.style.setProperty("box-shadow","unset","important")))}}}function A(){return A=Object.assign?Object.assign.bind():function(a){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var c in e)({}).hasOwnProperty.call(e,c)&&(a[c]=e[c])}return a},A.apply(null,arguments)}var ht=a=>{var{theme:n,settings:e={},styles:c=[]}=a,o={".cm-gutters":{}},r={};e.background&&(r.backgroundColor=e.background),e.backgroundImage&&(r.backgroundImage=e.backgroundImage),e.foreground&&(r.color=e.foreground),e.fontSize&&(r.fontSize=e.fontSize),(e.background||e.foreground)&&(o["&"]=r),e.fontFamily&&(o["&.cm-editor .cm-scroller"]={fontFamily:e.fontFamily}),e.gutterBackground&&(o[".cm-gutters"].backgroundColor=e.gutterBackground),e.gutterForeground&&(o[".cm-gutters"].color=e.gutterForeground),e.gutterBorder&&(o[".cm-gutters"].borderRightColor=e.gutterBorder),e.caret&&(o[".cm-content"]={caretColor:e.caret},o[".cm-cursor, .cm-dropCursor"]={borderLeftColor:e.caret});var l={};e.gutterActiveForeground&&(l.color=e.gutterActiveForeground),e.lineHighlight&&(o[".cm-activeLine"]={backgroundColor:e.lineHighlight},l.backgroundColor=e.lineHighlight),o[".cm-activeLineGutter"]=l,e.selection&&(o["&.cm-focused .cm-selectionBackground, & .cm-line::selection, & .cm-selectionLayer .cm-selectionBackground, .cm-content ::selection"]={background:e.selection+" !important"}),e.selectionMatch&&(o["& .cm-selectionMatch"]={backgroundColor:e.selectionMatch});var u=_.EditorView.theme(o,{dark:n==="dark"}),h=y.HighlightStyle.define(c),B=[u,y.syntaxHighlighting(h)];return B},s={background:"#F5F5F5",foreground:"#333333",selection:"#C9D0D9",cursor:"#54494B",activeLine:"#79ff002b",keyword:"#4B69C6",variable:"#7A3E9D",function:"#AA3731",string:"#448C27",constant:"#9C5D27",type:"#7A3E9D",class:"#AA3731",number:"#9C5D27",comment:"#AAAAAA",heading:"#AA3731",invalid:"#cd3131",regexp:"#4B69C6",tag:"#4B69C6"},ft={background:s.background,foreground:s.foreground,caret:s.cursor,selection:s.selection,selectionMatch:s.selection,gutterBackground:s.background,gutterForeground:s.foreground,gutterBorder:"transparent",lineHighlight:s.activeLine},kt=[{tag:t.tags.keyword,color:s.keyword},{tag:[t.tags.name,t.tags.deleted,t.tags.character,t.tags.macroName],color:s.variable},{tag:[t.tags.propertyName],color:s.function},{tag:[t.tags.processingInstruction,t.tags.string,t.tags.inserted,t.tags.special(t.tags.string)],color:s.string},{tag:[t.tags.function(t.tags.variableName),t.tags.labelName],color:s.function},{tag:[t.tags.color,t.tags.constant(t.tags.name),t.tags.standard(t.tags.name)],color:s.constant},{tag:[t.tags.definition(t.tags.name),t.tags.separator],color:s.variable},{tag:[t.tags.className],color:s.class},{tag:[t.tags.number,t.tags.changed,t.tags.annotation,t.tags.modifier,t.tags.self,t.tags.namespace],color:s.number},{tag:[t.tags.typeName],color:s.type,fontStyle:s.type},{tag:[t.tags.operator,t.tags.operatorKeyword],color:s.keyword},{tag:[t.tags.url,t.tags.escape,t.tags.regexp,t.tags.link],color:s.regexp},{tag:[t.tags.meta,t.tags.comment],color:s.comment},{tag:t.tags.tagName,color:s.tag},{tag:t.tags.strong,fontWeight:"bold"},{tag:t.tags.emphasis,fontStyle:"italic"},{tag:t.tags.link,textDecoration:"underline"},{tag:t.tags.heading,fontWeight:"bold",color:s.heading},{tag:[t.tags.atom,t.tags.bool,t.tags.special(t.tags.variableName)],color:s.variable},{tag:t.tags.invalid,color:s.invalid},{tag:t.tags.strikethrough,textDecoration:"line-through"}],pt=a=>{var{theme:n="light",settings:e={},styles:c=[]}={};return ht({theme:n,settings:A({},ft,e),styles:[...kt,...c]})},bt=pt();dt({light:{extension:bt},options:{settingsKey:"extension.markeditThemeQuietLight"}});
